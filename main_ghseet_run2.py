import warnings
import numpy as np
import datetime as dt
from time import sleep
from realised_scalping_pnl import ScalpingPnl
from unrealised_holding_pnl import HoldingPnl
from update_gsheet2 import Gsheet

warnings.filterwarnings("ignore")

eid_list1_sheet1 = [11427, 11426, 11425, 11424, 11423, 11422, 11421, 11420, 11419, 11418,
                    11528, 11527, 11526, 11525, 11524, 11489, 11488, 11487, 11486, 11485, 11484, 11483,
                    11561, 11560, 11559, 11558, 11557, 11556, 11555, 11554, 11553, 11552, 11551, 11550,
                    11680, 11679, 11678, 11677,
                    11726, 11727, 11728, 11729,
                    11771, 11772, 11773, 11774]
# list2 from other account
eid_list2_sheet1 = [11826, 11825, 11824, 11823,
                    11858, 11857, 11856, 11855,
                    11929, 11928, 11927, 11926,
                    11982, 11983, 11984, 11985,
                    12025, 12026, 12027, 12028,
                    12055, 12056, 12057, 12058,
                    12098, 12099, 12100, 12101,
                    12146, 12147, 12148, 12149,
                    12177, 12178, 12179, 12180,
                    12230, 12231, 12232, 12233,
                    12294, 12293, 12292, 12288,
                    12358, 12359, 12360, 12361,
                    12397, 12399, 12400, 12401]
# moved to sheet 2 because 100 rows full
eid_list1_sheet2 = [12461, 12462, 12463, 12464,
                    12525, 12526, 12527, 12528,
                    12579, 12580, 12581,
                    12646, 12647, 12648, 12649,
                    12725, 12732, 12733, 12737,
                    12796, 12797, 12798, 12799,
                    12854, 12855, 12856, 12857,
                    12916, 12917, 12918, 12919,
                    12963, 12964, 12965, 12969,
                    13043, 13044, 13045, 13046,
                    13090, 13091, 13092, 13093,
                    13161, 13162, 13163, 13164,
                    13231, 13232, 13233, 13234,
                    13290, 13291, 13292, 13296,
                    13434, 13435, 13436, 13437,
                    13477, 13478, 13479, 13480,
                    13558, 13559, 13560, 13561,
                    13635, 13636, 13640, 13641, 13642, 13643, 13644, 13645,
                    13715, 13716, 13717, 13718, 13719, 13720, 13721, 13722,
                    13762, 13763, 13764, 13765, 13766, 13767, 13768, 13769,
                    13839, 13840, 13841, 13842, 13843, 13844, 13845, 13846]
eid_list1_sheet3 = [13909, 13910, 13911, 13912, 13913, 13914, 13915, 13916,
                    13977, 13978, 13979, 13983, 13984, 13985, 13986, 13987,
                    14042, 14043, 14044, 14045, 14046, 14047, 14048, 14049,
                    14093, 14094, 14095, 14096, 14097, 14098, 14099, 14100,
                    14163, 14164, 14165, 14166, 14167, 14168, 14169, 14170,
                    14233, 14234, 14235, 14236, 14237, 14238, 14239, 14240,
                    14285, 14286, 14287, 14288, 14289, 14290, 14292, 14293,
                    14359, 14360, 14361, 14362, 14363, 14364, 14365, 14366,
                    14437, 14438, 14439, 14440, 14441, 14442, 14443, 14444,
                    14521, 14522, 14523, 14524, 14525, 14526, 14527, 14528,
                    14631, 14632, 14633, 14634, 14635, 14636, 14637, 14638,
                    14688, 14689, 14690, 14691, 14692, 14693, 14694, 14695,
                    14746, 14747, 14748, 14749, 14750, 14751, 14752, 14753,
                    14804, 14805, 14806, 14807, 14808, 14809, 14810, 14811,
                    14886, 14887, 14888, 14889, 14890, 14891, 14892, 14893,
                    14972, 14973, 14974, 14975, 14976, 14977, 14978, 14979,
                    15055, 15056, 15057, 15058, 15059, 15060, 15061, 15062,
                    15143, 15144, 15145, 15146, 15147, 15148, 15149, 15150]
eid_list1_sheet4 = [15218, 15219, 15220, 15221, 15222, 15223, 15224, 15225,
                    15289, 15290, 15291, 15292, 15293, 15294, 15295, 15296,
                    15361, 15362, 15363, 15364, 15365, 15366, 15367, 15368,
                    15449, 15450, 15451, 15452, 15453, 15454, 15455, 15456,
                    15542, 15543, 15544, 15545, 15546, 15547, 15549, 15550,
                    15654, 15655, 15656, 15657, 15658, 15659, 15660, 15661,
                    15754, 15755, 15756, 15757, 15758, 15759, 15760, 15761,
                    15846, 15847, 15848, 15849, 15850, 15851, 15852, 15853,
                    15923, 15939, 15940, 15941, 15942, 15943, 15944, 15945,
                    16035, 16036, 16037, 16038, 16039, 16040, 16041, 16042,
                    16121, 16122, 16123, 16124, 16125, 16126, 16127, 16128,
                    16239, 16240, 16241, 16242, 16243, 16244, 16245, 16246,
                    16338, 16339, 16340, 16341, 16342, 16343, 16344, 16345,
                    16469, 16470, 16471, 16472, 16473, 16474, 16475, 16476,
                    16533, 16534, 16535, 16536, 16537, 16538, 16539, 16540,
                    16610, 16611, 16612, 16613, 16614, 16615, 16616, 16617,
                    16715, 16716, 16717, 16718, 16719, 16720, 16721, 16722,
                    16805, 16806, 16807, 16808, 16809, 16810, 16811, 16812,
                    16921, 16922, 16923, 16924, 16925, 16926, 16927, 16928,
                    17035, 17036, 17037, 17038, 17039, 17040, 17041, 17042,
                    17181, 17183, 17184, 17186, 17187,
                    17293, 17292, 17291, 17290, 17289,
                    17399, 17398, 17397, 17396, 17395,
                    17510, 17509, 17508, 17507, 17506,
                    17608, 17609, 17610, 17611, 17612,
                    17696, 17697, 17698, 17699, 17700, 17701, 17702, 17703, 17705,
                    17827, 17826, 17825, 17824, 17823,
                    17827, 17826, 17825, 17824, 17823,
                    17923, 17922, 17921, 17920,
                    18015, 18016, 18017, 18018, 18019,
                    18216, 18217, 18218, 18219, 18220,
                    18336, 18337, 18338, 18339, 18340, 18430, 18431, 18432, 18433, 18434, 18533, 18534, 18535, 18538,
                    18544,
                    18548, 18558,
                    18565, 18566, 18567, 18568, 18569, 18575, 18576, 18577, 18578, 18579, 18580, 18585, 18586, 18587,
                    18588,
                    18589, 18590,
                    18593, 18594, 18595, 18596, 18597, 18598, 18599, 18600, 18601, 18602, 18603, 18604, 18606, 18612,
                    18621,
                    18624, 18628,
                    18631, 18632, 18633, 18634
                    ]

eid_list_now = [18635, 18636, 18637, 18639, 18640, 18641, 18643, 18644, 18646, 18650, 18651, 18652, 18654, 18655, 18656, 18663, 18664, 18665, 18666, 18667, 18668, 18672, 18673, 18677, 18684, 18685, 18686, 18693, 18694, 18695, 18696, 18697, 18698, 18702, 18703, 18704, 18706, 18708, 18709, 18716, 18718, 18719, 18720, 18721, 18722, 18726, 18728, 18730, 18733, 18736, 18742, 18750, 18757, 18763, 18764, 18766, 18768, 18772, 18773, 18774, 18775, 18776, 18777, 18784, 18785, 18786, 18787, 18788, 18789, 18793, 18794, 18795, 18796, 18797, 18798, 18803, 18804, 18805, 18806, 18807, 18808, 18809, 18810, 18811, 18812, 18813, 18814, 18815, 18816, 18817, 18818, 18819, 18820, 18821, 18822, 18823, 18824, 18825, 18826, 18827, 18828, 18829, 18830, 18831, 18832, 18834, 18835, 18836, 18837, 18838, 18839, 18842, 18843, 18844, 18845, 18846, 18847, 18853, 18854, 18855, 18856, 18857, 18858, 18861, 18863, 18864, 18867, 18868, 18870, 18880, 18883, 18886, 18887, 18888, 18889, 18895, 18899, 18903, 18904, 18905, 18906, 18916, 18921, 18922, 18923, 18924, 18925, 18928, 18929, 18930, 18931, 18932, 18933, 18939, 18940, 18941, 18942, 18943, 18944, 18947, 18948, 18949, 18950, 18951, 18952, 18958, 18960, 18961, 18962, 18963, 18964, 18967, 18968, 18969, 18970, 18971, 18972, 18977, 18978, 18979, 18980, 18981, 18982, 18983, 18984, 18985, 18986, 18987, 18988, 18989, 18990, 18991, 18992, 18993, 18994, 18995, 18996, 18997, 18998, 18999, 19000, 19001, 19002, 19003]
eid_list_now = [19004, 19005, 19006, 19008, 19009, 19010, 19012, 19016, 19017, 19022, 19023, 19025, 19026, 19030, 19032, 19038, 19039, 19040, 19041, 19042, 19043, 19046, 19047, 19048, 19049, 19050, 19051, 19057, 19058, 19059, 19060, 19062, 19065, 19069, 19071, 19072, 19073, 19077, 19078, 19084, 19085, 19086, 19087, 19088, 19091, 19098, 19100, 19103, 19106, 19112, 19119, 19125, 19126, 19127, 19128, 19129, 19130, 19133, 19134, 19135, 19136, 19137, 19138, 19144, 19151, 19152, 19153, 19154, 19155, 19160, 19161, 19162, 19163, 19164, 19165, 19170, 19171, 19172, 19173, 19174, 19175, 19178, 19179, 19180, 19181, 19182, 19183, 19184, 19185, 19186, 19187, 19188, 19189, 19190, 19191, 19192, 19193, 19194, 19195, 19196, 19197, 19198]
eid_list_now = [19201, 19203, 19204, 19206, 19207, 19209, 19213, 19214, 19215, 19218, 19220, 19221, 19222, 19228, 19229, 19230, 19231, 19232, 19233, 19236, 19238, 19242, 19243, 19244, 19251, 19252, 19253, 19254, 19255, 19256, 19259, 19260, 19261, 19263, 19265, 19266, 19272, 19274, 19275, 19276, 19279, 19280, 19281, 19282, 19283, 19284, 19290, 19291, 19295, 19296, 19298, 19302, 19310, 19311, 19313, 19314, 19318, 19319, 19325, 19332, 19333, 19334, 19335, 19336, 19341, 19342, 19343, 19344, 19345, 19346, 19351, 19352, 19353, 19354, 19355, 19356, 19359, 19360, 19362, 19367, 19369, 19370, 19371, 19372, 19373, 19374, 19375, 19376, 19377, 19381, 19382, 19386, 19390, 19396, 19399, 19401, 19403, 19194, 19195, 19196, 19197, 19198]
eid_list_now = [19239, 19404, 19405, 19406, 19408, 19409, 19410, 19411, 19414, 19417, 19420, 19421, 19422, 19423, 19429, 19430, 19431, 19432, 19433, 19434, 19435, 19439, 19442, 19443, 19445, 19455, 19457, 19458, 19461, 19464, 19466, 19471, 19472, 19473, 19474, 19480, 19481, 19483, 19484, 19485, 19487, 19488, 19491, 19492, 19493, 19494, 19499, 19500, 19501, 19502, 19503, 19505, 19506, 19507, 19508, 19509, 19520, 19521, 19522, 19523, 19525, 19529, 19530, 19531, 19532, 19533, 19534, 19538, 19539, 19540, 19541, 19542, 19543, 19546, 19547, 19548, 19549, 19550, 19551, 19553, 19555, 19559, 19562, 19566, 19567, 19569, 19570, 19571, 19572, 19573, 19574, 19575, 19576, 19577, 19578, 19579, 19580, 19581, 19583, 19584, 19585, 19590, 19591, 19593, 19594, 19595, 19596, 19597, 19598, 19603, 19604, 19605, 19606, 19607, 19608, 19610, 19612, 19614, 19615, 19616, 19617, 19622, 19624, 19627, 19630, 19632, 19638, 19642, 19643, 19645, 19647, 19649, 19650, 19655, 19656, 19660, 19661, 19663, 19664, 19667, 19668, 19669, 19670, 19672, 19674, 19680, 19681, 19682, 19683, 19685, 19686, 19689, 19690, 19691, 19692, 19693, 19694, 19701, 19708, 19709, 19710, 19711, 19712, 19717, 19718, 19719, 19720, 19721, 19722, 19727, 19728, 19729, 19730, 19731, 19732, 19735, 19736, 19737, 19738, 19739, 19740, 19741, 19742, 19743, 19744, 19745, 19746, 19747, 19748, 19749, 19750, 19751, 19752, 19753, 19754, 19755]
eid_list_now = [19764, 19765, 19766, 19768, 19769, 19770, 19773, 19775, 19781, 19786, 19787, 19788, 19790, 19791, 19792, 19798, 19799, 19800, 19801, 19802, 19803, 19806, 19809, 19811, 19812, 19813, 19814, 19820, 19821, 19822, 19823, 19824, 19825, 19828, 19829, 19830, 19833, 19840, 19845, 19851, 19852, 19857, 19859, 19860, 19861, 19864, 19865, 19866, 19867, 19868, 19869, 19877, 19879, 19883, 19885, 19888, 19890, 19897, 19899, 19900, 19901, 19902, 19905, 19913, 19923, 19925, 19926, 19927, 19928, 19933, 19934, 19935, 19936, 19937, 19938, 19943, 19944, 19945, 19946, 19947, 19948, 19951, 19952, 19953, 19954, 19955, 19956, 19957, 19958, 19959, 19960, 19961, 19962, 19963, 19964, 19965, 19966, 19967, 19968, 19969, 19970, 19971]
eid_list_now = [19972, 19973, 19974, 19976, 19977, 19978, 19979, 19980, 19981, 19984, 19985, 19986, 19987, 19988, 19989, 19997, 20004, 20007, 20011, 20012, 20013, 20016, 20017, 20023, 20029, 20030, 20033, 20039, 20040, 20044, 20048, 20049, 20050, 20053, 20054, 20055, 20056, 20057, 20058, 20064, 20065, 20066, 20070, 20071, 20072, 20077, 20082, 20087, 20092, 20096, 20103, 20109, 20110, 20111, 20112, 20114, 20115, 20121, 20125, 20129, 20134, 20137, 20138, 20147, 20155, 20160, 20165, 20171, 20174, 20177, 20178, 20179, 20180, 20182, 20183, 20188, 20189, 20190, 20191, 20192, 20193, 20194, 20195, 20196, 20197, 20198, 20199, 20200, 20201, 20202, 20203, 20204, 20205, 20206, 20207, 20208, 20209, 20210, 20211, 20212, 20213, 20214, 20218, 20219, 20220, 20222, 20223, 20224, 20225, 20226, 20227, 20230, 20231, 20232, 20233, 20235, 20236, 20243, 20244, 20245, 20246, 20247, 20248, 20251, 20252, 20254, 20261, 20262, 20263, 20269, 20277, 20278, 20279, 20280, 20281, 20284, 20285, 20286, 20287, 20288, 20289, 20295, 20296, 20297, 20298, 20299, 20300, 20303, 20304, 20305, 20306, 20314, 20316, 20324, 20329, 20336, 20338, 20339, 20340, 20343, 20344, 20345, 20346, 20347, 20348, 20354, 20355, 20356, 20357, 20358, 20359, 20362, 20363, 20364, 20365, 20366, 20367, 20372, 20373, 20374, 20375, 20376, 20377, 20378, 20379, 20380, 20381, 20382, 20383, 20384, 20385, 20386, 20387, 20388, 20389, 20390, 20391, 20392, 20393, 20394, 20395, 20396, 20397, 20398]
eid_list_now = [20399, 20400, 20401, 20402, 20403, 20404, 20406, 20409, 20411, 20414, 20415, 20416, 20417, 20418, 20419, 20425, 20426, 20427, 20428, 20429, 20430, 20433, 20434, 20435, 20436, 20437, 20438, 20444, 20445, 20446, 20447, 20448, 20449, 20453, 20454, 20455, 20457, 20460, 20461, 20467, 20468, 20469, 20470, 20476, 20479, 20484, 20485, 20486, 20490, 20494, 20495, 20501, 20503, 20504, 20505, 20510, 20517, 20522, 20523, 20524, 20525, 20526, 20532, 20539, 20540, 20543, 20553, 20556, 20567, 20568, 20569, 20570, 20571, 20572, 20577, 20578, 20579, 20580, 20581, 20582, 20585, 20586, 20587, 20588, 20589, 20590, 20591, 20592, 20593, 20594, 20595, 20596, 20597, 20598, 20599, 20600, 20601, 20602, 20603, 20604, 20605]
eid_list_now = [20606, 20607, 20608, 20610, 20611, 20612, 20615, 20618, 20619, 20622, 20623, 20624, 20625, 20626, 20627, 20633, 20634, 20635, 20636, 20637, 20638, 20641, 20642, 20643, 20644, 20645, 20646, 20652, 20653, 20655, 20656, 20657, 20658, 20663, 20667, 20668, 20669, 20670, 20674, 20681, 20682, 20685, 20687, 20688, 20689, 20693, 20696, 20700, 20701, 20707, 20716, 20724, 20734, 20737, 20738, 20745, 20753, 20756, 20757, 20758, 20759, 20760, 20761, 20767, 20774, 20775, 20776, 20777, 20778, 20783, 20784, 20785, 20786, 20787, 20788, 20793, 20794, 20795, 20796, 20797, 20798, 20801, 20802, 20803, 20804, 20805, 20806, 20807, 20808, 20809, 20810, 20811, 20812, 20813, 20814, 20815, 20816, 20817, 20818, 20819, 20820, 20821, 20822, 20823, 20824, 20826, 20827, 20829, 20832, 20837, 20838, 20841, 20849, 20850, 20851, 20852, 20853, 20854, 20857, 20858, 20875, 20886, 20895, 20906, 20908, 20911, 20912, 20913, 20916, 20917, 20918, 20919, 20924, 20925, 20931, 20932, 20933, 20934, 20935, 20937, 20940, 20941, 20942, 20943, 20944, 20945, 20951, 20952, 20953, 20954, 20955, 20956, 20959, 20960, 20961, 20962, 20967, 20974, 20975, 20976, 20977, 20978, 20983, 20984, 20985, 20986, 20987, 20988, 20994, 20995, 20996, 20997, 20998, 20999, 21002, 21003, 21004, 21005, 21006, 21007, 21008, 21009, 21010, 21011, 21012, 21013, 21015, 21016, 21017, 21018, 21019, 21020]
eid_list_now = [21022, 21023, 21024, 21026, 21027, 21028, 21029, 21034, 21035, 21038, 21039, 21040, 21041, 21042, 21043, 21049, 21050, 21055, 21059, 21065, 21066, 21069, 21070, 21071, 21072, 21076, 21077, 21083, 21084, 21085, 21086, 21087, 21088, 21090, 21091, 21092, 21093, 21094, 21095, 21121, 21128, 21129, 21130, 21131, 21132, 21134, 21135, 21136, 21137, 21138, 21139, 21144, 21145, 21146, 21147, 21148, 21149, 21154, 21160, 21166, 21167, 21168, 21169, 21175, 21183, 21190, 21197, 21198, 21199, 21204, 21205, 21206, 21211, 21212, 21213, 21218, 21219, 21220, 21221, 21222, 21223, 21226, 21227, 21230, 21231, 21233, 21234, 21235, 21236, 21237, 21238, 21239, 21240, 21241, 21242, 21243, 21244, 21245, 21246, 21247, 21248, 21249]
eid_list_now = [21253, 21254, 21256, 21257, 21258, 21263, 21268, 21270, 21274, 21275, 21276, 21277, 21278, 21280, 21286, 21287, 21288, 21289, 21292, 21296, 21302, 21303, 21306, 21309, 21310, 21311, 21346, 21347, 21348, 21349, 21350, 21351, 21355, 21356, 21357, 21358, 21361, 21362, 21368, 21369, 21370, 21371, 21372, 21373, 21377, 21378, 21379, 21380, 21381, 21382, 21404, 21405, 21406, 21407, 21408, 21409, 21412, 21413, 21414, 21415, 21418, 21421, 21430, 21437, 21438, 21439, 21440, 21441, 21446, 21447, 21448, 21449, 21450, 21451, 21456, 21457, 21458, 21459, 21460, 21461, 21464, 21465, 21466, 21467, 21468, 21469, 21470, 21471, 21472, 21473, 21474, 21475, 21476, 21477, 21478, 21479, 21480, 21481, 21482, 21483, 21484, 21491, 21492, 21493, 21494, 21495, 21496, 21497, 21498, 21499, 21500, 21509, 21510, 21517, 21518, 21519, 21520, 21523, 21525, 21534, 21537, 21538, 21539, 21540, 21541, 21563, 21564, 21565, 21566, 21567, 21568, 21603, 21609, 21610, 21611, 21620, 21621, 21622, 21623, 21624, 21625, 21629, 21630, 21631, 21632, 21633, 21634, 21657, 21658, 21659, 21660, 21661, 21662, 21665, 21666, 21667, 21668, 21669, 21670, 21676, 21677, 21678, 21681, 21685, 21688, 21691, 21692, 21693, 21694, 21695, 21696, 21701, 21702, 21703, 21704, 21705, 21706, 21707, 21708, 21709, 21710, 21711, 21712, 21713, 21714, 21715, 21716, 21717, 21718, 21719, 21720, 21721, 21722, 21723, 21724, 21725, 21726, 21727, 21748, 21749, 21750, 21751, 21755, 21756, 21757, 21758, 21759, 21760, 21766, 21767, 21768, 21769, 21770, 21771, 21775, 21776, 21777, 21778, 21779, 21780, 21801, 21802, 21803, 21805, 21806, 21807, 21839, 21840, 21841, 21842, 21843, 21844, 21850, 21851, 21852, 21853, 21854, 21855, 21859, 21860, 21861, 21862, 21863, 21864, 21885, 21886, 21887, 21888, 21889, 21890, 21893, 21894, 21895, 21896, 21897, 21898, 21904, 21905, 21907, 21910, 21911, 21912, 21915, 21916, 21917, 21918, 21919, 21920, 21925, 21926, 21927, 21928, 21929, 21930, 21931, 21932, 21933, 21934, 21935, 21936, 21937, 21938, 21939, 21940, 21941, 21942, 21943, 21944, 21945, 21946, 21947, 21948, 21949, 21950, 21951]
eid_list_now = [21954, 21955, 21956, 21958, 21959, 21960, 21963, 21966, 21967, 21971, 21973, 21974, 21977, 21979, 21980, 21986, 21987, 21988, 21989, 21990, 21991, 21995, 21997, 22001, 22002, 22003, 22004, 22026, 22027, 22028, 22029, 22030, 22031, 22048, 22049, 22051, 22052, 22053, 22059, 22060, 22061, 22062, 22066, 22067, 22068, 22069, 22070, 22076, 22077, 22078, 22079, 22080, 22083, 22084, 22085, 22086, 22087, 22089, 22095, 22096, 22097, 22098, 22099, 22100, 22103, 22104, 22105, 22106, 22107, 22113, 22114, 22115, 22116, 22117, 22118, 22119, 22120, 22121, 22122, 22123, 22124, 22125, 22126, 22127, 22128, 22129, 22130, 22131, 22132, 22133, 22134, 22135, 22136, 22137]
eid_list_now = [22141,22142,22143,22144,22145,22146,22147,22148,22149,22150,22151,22152,22153,22154,22156,22157,22158,22159,22160,22161,22162,22163,22164,22165,22166,22167,22168,22169,22170,22171,22172,22173,22174,22177,22178,22179,22180,22181,22182,22183,22184,22195,22196,22197,22198,22199,22204,22205,22206,22208,22224,22225,22226,22227,22228,22229,22230,22231,22233,22234,22235,22236,22237,22238,22239,22242,22243,22244,22245,22249,22250,22251,22252]
eid_list_now = [22253, 22255, 22277, 22278, 22279, 22280, 22282, 22283, 22286, 22289, 22295, 22296, 22297, 22298, 22303, 22310, 22311, 22312, 22313, 22314, 22319, 22320, 22321, 22322, 22323, 22324, 22329, 22330, 22331, 22332, 22333, 22334, 22337, 22338, 22339, 22340, 22341, 22342, 22343, 22344, 22345, 22346, 22347, 22348, 22349, 22350, 22351, 22352, 22353, 22354, 22355, 22356, 22357]
eid_list_now = [22362, 22363, 22364, 22366, 22367, 22370, 22374, 22379, 22380, 22381, 22382, 22388, 22389, 22390, 22391, 22392, 22393, 22397, 22398, 22399, 22400, 22401, 22402, 22415, 22416, 22417, 22418, 22423, 22424, 22429, 22430, 22431, 22432, 22433, 22434, 22440, 22441, 22442, 22443, 22444, 22446, 22450, 22451, 22452, 22453, 22454, 22455, 22461, 22462, 22463, 22464, 22467, 22468, 22474, 22476, 22478, 22479, 22485, 22492, 22493, 22494, 22495, 22496, 22501, 22502, 22503, 22504, 22505, 22506, 22511, 22512, 22513, 22514, 22515, 22516, 22519, 22520, 22521, 22522, 22523, 22524, 22525, 22526, 22527, 22528, 22529, 22530, 22531, 22532, 22533, 22534, 22535, 22536, 22539]
eid_list_now = [22537, 22538, 22547, 22548, 22549, 22551, 22552, 22553, 22556, 22559, 22560, 22567, 22568, 22569, 22570, 22571, 22572, 22578, 22579, 22580, 22581, 22582, 22583, 22587, 22588, 22589, 22590, 22612, 22613, 22614, 22615, 22616, 22634, 22635, 22636, 22637, 22638, 22639, 22646, 22647, 22648, 22649, 22650, 22651, 22655, 22656, 22657, 22658, 22659, 22660, 22666, 22667, 22671, 22678, 22679, 22680, 22707, 22708, 22709, 22710, 22711, 22712, 22716, 22717, 22718, 22719, 22720, 22721, 22722, 22723, 22724, 22725, 22726, 22727, 22728, 22729, 22730, 22731, 22732, 22733, 22734, 22735, 22736]
eid_list_now = [22734, 22735, 22736, 22668, 22669, 22670, 22686, 22687, 22694, 22695, 22696, 22697, 22698, 22741, 22742, 22743, 22745, 22746, 22747, 22753, 22757, 22759, 22764, 22765, 22766, 22767, 22768, 22769, 22775, 22776, 22777, 22778, 22780, 22782, 22786, 22787, 22788, 22789, 22790, 22791, 22813, 22814, 22815, 22816, 22817, 22818, 22835, 22836, 22837, 22838, 22839, 22840, 22847, 22848, 22849, 22850, 22851, 22852, 22856, 22857, 22858, 22863, 22869, 22870, 22871, 22873, 22876, 22878, 22882, 22886, 22888, 22890, 22897, 22905, 22907, 22909, 22911, 22913, 22920, 22926, 22928, 22930, 22936, 22937, 22939, 22941, 22945, 22947, 22949, 22951, 22953, 22955, 22957, 22959, 22961, 22963, 22965, 22967, 22969, 22971, 22973, 22975, 22977, 22979, 22981, 22983, 22985, 22872, 22875, 22877, 22880, 22883, 22884, 22885, 22887, 22889, 22892, 22898, 22906, 22908, 22910, 22912, 22916, 22927, 22929, 22932, 22938, 22940, 22942, 22946, 22948, 22950, 22952, 22954, 22956, 22958, 22960, 22962, 22964, 22966, 22968, 22970, 22972, 22974, 22976, 22978, 22980, 22982, 22984]
eid_list_now = [22922, 22924, 22991, 22993, 22995, 22998, 23000, 23002, 23004, 23006, 23008, 23014, 23016, 23018, 23020, 23022, 23024, 23032, 23034, 23036, 23038, 23040, 23042, 23046, 23048, 23050, 23052, 23054, 23056, 23079, 23081, 23084, 23091, 23095, 23097, 23102, 23104, 23106, 23108, 23110, 23112, 23122, 23124, 23126, 23128, 23130, 23132, 23137, 23139, 23141, 23143, 23145, 23147, 23171, 23173, 23175, 23177, 23179, 23181, 23185, 23187, 23189, 23191, 23193, 23195, 23202, 23204, 23206, 23208, 23210, 23212, 23217, 23219, 23221, 23223, 23225, 23227, 23233, 23235, 23237, 23239, 23241, 23243, 23245, 23247, 23249, 23251, 23253, 23255, 23257, 23259, 23261, 23263, 23265, 23267, 23269, 23271, 23273, 23275, 23277, 23279, 23281, 23283, 23285, 22923, 22925, 22990, 22992, 22994, 22997, 22999, 23001, 23003, 23005, 23007, 23012, 23015, 23017, 23019, 23021, 23023, 23027, 23033, 23035, 23037, 23039, 23041, 23045, 23047, 23049, 23051, 23053, 23055, 23074, 23080, 23083, 23087, 23094, 23096, 23100, 23103, 23105, 23107, 23109, 23111, 23117, 23123, 23125, 23127, 23129, 23131, 23135, 23138, 23140, 23142, 23144, 23146, 23166, 23172, 23174, 23176, 23178, 23180, 23183, 23186, 23188, 23190, 23192, 23194, 23197, 23203, 23205, 23207, 23209, 23211, 23215, 23218, 23220, 23222, 23224, 23226, 23229, 23234, 23236, 23238, 23240, 23242, 23244, 23246, 23248, 23250, 23252, 23254, 23256, 23258, 23260, 23262, 23264, 23266, 23268, 23270, 23272, 23274, 23276, 23278, 23280, 23282, 23284, 23318, 23320, 23322, 23327, 23329, 23331, 23333, 23335, 23337, 23344, 23347, 23349, 23356, 23358, 23361, 23364, 23366, 23390, 23395, 23397, 23400, 23403, 23405, 23422, 23425, 23427, 23430, 23433, 23435, 23442, 23447, 23449, 23452, 23455, 23457, 23461, 23464, 23466, 23469, 23472, 23474, 23481, 23484, 23486, 23489, 23492, 23494, 23498, 23502, 23504, 23507, 23510, 23512, 23519, 23522, 23524, 23527, 23530, 23532, 23536, 23539, 23541, 23549, 23556, 23559, 23561, 23564, 23567, 23570, 23572, 23575, 23578, 23580, 23583, 23586, 23588, 23591, 23594, 23596, 23599, 23602, 23604, 23607, 23610, 23612, 23615, 23618, 23620, 23319, 23321, 23325, 23328, 23330, 23332, 23334, 23336, 23340, 23345, 23348, 23354, 23357, 23360, 23362, 23365, 23385, 23393, 23396, 23399, 23401, 23404, 23421, 23423, 23426, 23429, 23431, 23434, 23439, 23443, 23448, 23451, 23453, 23456, 23460, 23462, 23465, 23468, 23470, 23473, 23477, 23482, 23485, 23488, 23490, 23493, 23497, 23499, 23503, 23506, 23508, 23511, 23515, 23520, 23523, 23526, 23528, 23531, 23535, 23537, 23540, 23552, 23557, 23560, 23566, 23568, 23571, 23574, 23576, 23579, 23582, 23584, 23587, 23590, 23592, 23595, 23598, 23600, 23603, 23606, 23608, 23611, 23614, 23616, 23619, 23346, 23350, 23351, 23352, 23355, 23359, 23363, 23367, 23394, 23398, 23402, 23406, 23424, 23428, 23432, 23436, 23444, 23450, 23454, 23458, 23463, 23467, 23471, 23475, 23483, 23487, 23491, 23495, 23500, 23505, 23509, 23513, 23521, 23525, 23529, 23550, 23558, 23562, 23563, 23565, 23569, 23573, 23577, 23581, 23585, 23589, 23593, 23597, 23601, 23605, 23609, 23613, 23617, 23621]
# eid_list_now = [23626, 23627, 23628, 23629, 23630, 23631, 23632, 23633, 23635, 23636, 23637, 23638, 23639, 23640, 23641, 23642, 23643, 23644, 23649, 23650, 23651, 23652, 23653, 23654, 23657, 23658, 23659, 23660, 23662, 23663, 23664, 23665, 23666, 23667, 23668, 23669, 23670, 23671, 23672, 23673, 23675, 23679, 23680, 23681, 23682, 23683, 23684, 23685, 23686, 23687, 23689, 23690, 23691, 23692, 23693, 23694, 23697, 23699, 23700, 23701, 23702, 23703, 23704, 23705, 23706, 23707, 23708, 23709, 23711, 23712, 23713, 23718, 23719, 23721, 23722, 23723, 23724, 23725, 23726, 23727, 23728, 23729, 23730, 23746, 23747, 23748, 23749, 23750, 23751, 23752, 23753, 23754, 23755, 23756, 23757, 23758, 23759, 23760, 23761, 23765, 23769, 23770, 23771, 23772, 23773, 23774, 23775, 23776, 23777, 23778, 23779, 23780, 23781, 23782, 23783, 23785, 23786, 23787, 23788, 23789, 23790, 23791, 23792, 23793, 23794, 23795, 23796, 23797, 23798, 23799, 23800, 23803, 23807, 23808, 23809, 23810, 23813, 23814, 23815, 23816, 23817, 23818, 23819, 23820, 23821, 23822, 23823, 23825, 23828, 23829, 23830, 23831, 23832, 23833, 23834, 23835, 23836, 23837, 23838, 23839, 23840, 23841, 23842, 23844, 23848, 23849, 23850, 23857, 23858, 23859, 23860, 23861, 23862, 23863, 23864, 23865, 23866, 23867, 23869, 23872, 23873, 23874, 23875, 23876, 23877, 23878, 23879, 23880]
eid_list_now = [23544, 23547, 23627, 23630, 23632, 23636, 23639, 23641, 23644, 23651, 23653, 23658, 23662, 23664, 23667, 23670, 23672, 23679, 23682, 23684, 23687, 23691, 23693, 23699, 23702, 23703, 23706, 23709, 23712, 23721, 23724, 23727, 23729, 23747, 23750, 23752, 23755, 23758, 23760, 23769, 23772, 23774, 23777, 23780, 23782, 23786, 23789, 23791, 23794, 23797, 23799, 23807, 23810, 23814, 23817, 23820, 23822, 23828, 23831, 23836, 23839, 23841, 23848, 23857, 23861, 23864, 23866, 23872, 23875, 23877, 23880, 23883, 23885, 23892, 23895, 23897, 23900, 23903, 23905, 23910, 23913, 23915, 23918, 23921, 23923, 23926, 23929, 23931, 23934, 23937, 23939, 23942, 23945, 23947, 23950, 23953, 23955, 23958, 23961, 23963, 23548, 23626, 23628, 23631, 23635, 23637, 23640, 23643, 23649, 23652, 23657, 23659, 23663, 23666, 23668, 23671, 23675, 23680, 23683, 23686, 23689, 23692, 23697, 23700, 23705, 23707, 23711, 23719, 23723, 23725, 23728, 23746, 23748, 23751, 23754, 23756, 23759, 23765, 23771, 23773, 23776, 23778, 23781, 23785, 23787, 23790, 23793, 23795, 23798, 23803, 23808, 23813, 23816, 23818, 23821, 23825, 23829, 23832, 23835, 23837, 23840, 23844, 23849, 23858, 23860, 23862, 23865, 23869, 23873, 23876, 23879, 23881, 23884, 23888, 23893, 23896, 23899, 23901, 23904, 23907, 23911, 23914, 23917, 23919, 23922, 23925, 23927, 23930, 23933, 23935, 23938, 23941, 23943, 23946, 23949, 23951, 23954, 23957, 23959, 23962, 23533, 23538, 23542, 23546, 23629, 23633, 23638, 23642, 23650, 23654, 23660, 23665, 23669, 23673, 23681, 23685, 23690, 23694, 23701, 23704, 23708, 23713, 23718, 23722, 23726, 23730, 23749, 23753, 23757, 23761, 23770, 23775, 23779, 23783, 23788, 23792, 23796, 23800, 23809, 23815, 23819, 23823, 23830, 23838, 23842, 23850, 23859, 23863, 23867, 23874, 23878, 23882, 23886, 23894, 23898, 23902, 23906, 23912, 23916, 23920, 23924, 23928, 23932, 23936, 23940, 23944, 23948, 23952, 23956, 23960, 23964]
gs = Gsheet(category="btc")
# while True:
try:
    t1 = dt.datetime.now()
    i = 437
    apitype = "p"
    userid = 0
    for eid in eid_list_now:    
        print("running for ", eid)
        hpnl = HoldingPnl(eid, apitype, userid)
        hpnl.total_pnl_at_resolution()
        # print(eid, hpnl.pnl_if_yes, hpnl.pnl_if_no, hpnl.pnl_if_yes + hpnl.pnl_if_no)

        spnl = ScalpingPnl(eid, apitype='p', userid=603727)
        spnl.get_transactions()
        spnl.get_true_qty_traded()
        grouped = spnl.calculate_daywise_pnl()

        ifyes_tot = np.round(spnl.yes_total_pnl + spnl.no_total_pnl + hpnl.pnl_if_yes, 2)
        ifno_tot = np.round(spnl.yes_total_pnl + spnl.no_total_pnl + hpnl.pnl_if_no, 2)

        netpnl = spnl.netpnl + hpnl.unexecuted_value

        status1 = "Closed" if ("Closed" in spnl.orders_df["status"].values) else ""
        status2 = "Settled" if ("Settled" in spnl.orders_df["status"].values) else ""

        eid_data = [[eid, str(spnl.first_date), netpnl, status1, status2, ifyes_tot, ifno_tot, hpnl.pnl_if_yes,
                     hpnl.pnl_if_no,
                     spnl.yes_total_pnl,
                     spnl.no_total_pnl, spnl.totalqty, spnl.yesqty, spnl.noqty]]

        status1 = "Closed" if (status1 == "Closed") else "NotClosed"
        status2 = "Settled" if (status2 == "Settled") else "NotSettled"
        print(eid, "|", spnl.first_date, "|", netpnl, "|", status1, "|", status2, "|", spnl.yes_total_pnl, "|",
              spnl.no_total_pnl)
        gs.event_sheet.update(f'A{i}:N{i}', eid_data)
        gs.event_sheet.update('P1', "updated at: " + str(dt.datetime.now()))
        i += 1
    t2 = dt.datetime.now()
    print("-" * 20, t2)
    print(t2 - t1)
except Exception as e:
    print(f"Event{eid}", e)
    print("Last failed run at: ", dt.datetime.now())
    print("Next run at: ", dt.datetime.now() + dt.timedelta(seconds=60))
    sleep(60)
    raise e
else:
    print("Updated.", eid)
    print("Last successful run at: ", dt.datetime.now())
    # print("Next run at: ", dt.datetime.now() + dt.timedelta(seconds=300))
    # sleep(300)
